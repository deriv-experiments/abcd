{
  "version": 3,
  "sources": ["../src/getCookieValue.ts", "../src/index.ts", "index.js"],
  "sourcesContent": ["export default function getCookieValue (name: string): string | undefined {\n  if (!name || typeof name !== 'string') {\n    throw new Error('Invalid cookie name provided');\n  }\n\n  const namePattern = /^[^;=\\s]+$/;\n  if (!namePattern.test(name)) {\n    throw new Error('Invalid characters in cookie name');\n  }\n\n  const value = `; ${document.cookie}`;\n  const parts = value.split(`; ${name}=`);\n\n  if (parts.length === 2) {\n    const decodedValue = decodeURIComponent(parts.pop()?.split(';').shift() ?? '');\n    if (decodedValue) {\n      return decodedValue;\n    } else {\n      throw new Error('Error decoding cookie value');\n    }\n  }\n}\n", "import getCookieValue from './getCookieValue.ts';\n\nexport interface TestConfig {\n  name: string\n  variants: Record<string, number>\n}\n\nexport let abTests: Record<string, string | number> = {};\n(globalThis as any).abTests = abTests;\n\n// Tests expire in 30 days\nconst TEST_EXPIRE_TIME = (60 * 60 * 24) * 30;\n\nfunction ensureStyleAppended (): void {\n  if (document.getElementById('abTestStyles') != null) {\n    return;\n  }\n\n  const style = globalThis.document.createElement('style');\n  style.id = 'abTestStyles';\n  globalThis.document.head.appendChild(style);\n\n  insertCssRule('[ab-test-variant]:not([ab-test-variant=\"control\"]) { display: none; }');\n}\n\nfunction insertCssRule (rule: string): void {\n  const stylesheet = document.getElementById('abTestStyles') as HTMLStyleElement;\n  const sheet = stylesheet.sheet as CSSStyleSheet;\n  sheet.insertRule(rule, sheet.cssRules.length);\n}\n\nexport default function init (config: TestConfig[]): Record<string, string | number> {\n  ensureStyleAppended();\n  abTests = {};\n\n  for (const test of config) {\n    setupTest(test);\n  }\n\n  function setupTest (test: TestConfig): void {\n    const cookieName = `ab-${test.name}`;\n    let chosenVariant = getCookieValue(cookieName);\n\n    if (chosenVariant && !test.variants[chosenVariant]) {\n      chosenVariant = undefined;\n    }\n\n    abTests[test.name] = chosenVariant ?? 'control';\n\n    if (!chosenVariant) {\n      const rand = Math.random();\n      let cumulativeProbability = 0;\n      chosenVariant = 'control';\n      for (const variant in test.variants) {\n        cumulativeProbability += test.variants[variant];\n        if (rand <= cumulativeProbability) {\n          chosenVariant = variant;\n          break;\n        }\n      }\n\n      globalThis.document.cookie = `${cookieName}=${chosenVariant}; path=/; max-age=${TEST_EXPIRE_TIME}`;\n    }\n\n    for (const variant in test.variants) {\n      const rule = `[ab-test-name=\"${test.name}\"][ab-test-variant=\"${variant}\"] { display: ${variant === chosenVariant ? 'inherit' : 'none'}; }`;\n      insertCssRule(rule);\n    }\n  }\n\n  (globalThis as any).abTests = abTests;\n  return abTests;\n}\n\nconst configPath = globalThis.document?.currentScript?.getAttribute('config');\n\nif (configPath) {\n  ensureStyleAppended();\n\n  fetch(configPath)\n    .then(async (response) => await response.json())\n    .then(init)\n    .catch((error) => { console.error('Error loading A/B test configuration:', error); });\n}\n", "import abcd from '../dist/index.js';\nabcd([]);\n\nfunction convertGrowthbookToABCD (obj) {\n  const result = [];\n\n  for (const key in obj) {\n    const rules = obj[key].rules;\n    const defaultValue = obj[key].defaultValue;\n\n    for (const rule of rules) {\n      const variants = {};\n\n      for (let i = 0; i < rule.variations.length; i++) {\n        const variation = rule.variations[i];\n        const weight = rule.coverage === 1 ? rule.weights[i] : variation === defaultValue ? 1 : 0;\n        variants[variation] = weight;\n      }\n\n      result.push({\n        name: key,\n        variants: variants\n      });\n    }\n  }\n\n  return result;\n}\n\n(async function main () {\n  const growthbookResponse = await fetch(\n    'https://cdn.growthbook.io/api/features/sdk-0aHHaxKhwn0bP1HE'\n  );\n  const { features } = await growthbookResponse.json();\n  const config = convertGrowthbookToABCD(features);\n  const tests = abcd(config);\n  console.log(tests);\n})();\n"],
  "mappings": "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",
  "names": ["getCookieValue", "name", "parts", "decodedValue", "_b", "_a", "abTests", "TEST_EXPIRE_TIME", "ensureStyleAppended", "style", "insertCssRule", "rule", "sheet", "init", "config", "test", "setupTest", "cookieName", "chosenVariant", "rand", "cumulativeProbability", "variant", "configPath", "response", "error", "init", "convertGrowthbookToABCD", "obj", "result", "key", "rules", "defaultValue", "rule", "variants", "variation", "weight", "growthbookResponse", "features", "config", "tests"]
}
