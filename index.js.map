{
  "version": 3,
  "sources": ["../src/getCookieValue.ts", "../src/index.ts"],
  "sourcesContent": ["export default function getCookieValue(name: string): string | undefined {\n  if (!name || typeof name !== \"string\") {\n    throw new Error(\"Invalid cookie name provided\");\n  }\n\n  const namePattern = /^[^;=\\s]+$/;\n  if (!namePattern.test(name)) {\n    throw new Error(\"Invalid characters in cookie name\");\n  }\n\n  const value = `; ${document.cookie}`;\n  const parts = value.split(`; ${name}=`);\n\n  if (parts.length === 2) {\n    const decodedValue = decodeURIComponent(parts.pop()?.split(\";\").shift() || \"\");\n    if (decodedValue) {\n      return decodedValue;\n    } else {\n      throw new Error(\"Error decoding cookie value\");\n    }\n  }\n}\n", "import getCookieValue from './getCookieValue.ts';\n\nexport type TestConfig = {\n  name: string;\n  variants: { [key: string]: number };\n};\n\nfunction ensureStyleAppended() {\n  if (document.getElementById(\"abTestStyles\")) {\n    return;\n  }\n\n  const style = globalThis.document.createElement(\"style\");\n  style.id = \"abTestStyles\";\n  globalThis.document.head.appendChild(style);\n\n  insertCssRule('[ab-test-variant]:not([ab-test-variant=\"control\"]) { display: none; }');\n}\n\nfunction insertCssRule(rule: string) {\n  const stylesheet = document.getElementById(\"abTestStyles\") as HTMLStyleElement;\n  const sheet = stylesheet.sheet as CSSStyleSheet;\n  sheet.insertRule(rule, sheet.cssRules.length);\n}\n\nexport default function init(config: TestConfig[]): void {\n  ensureStyleAppended();\n\n  for (const test of config) {\n    setupTest(test);\n  }\n\n  function setupTest(test: TestConfig): void {\n    const cookieName = `ab-${test.name}`;\n    let chosenVariant = getCookieValue(cookieName);\n\n    if (!chosenVariant) {\n      // Calculate the random number to choose a variant\n      const rand = Math.random();\n      let sum = 0;\n\n      // Iterate through the test's variants to find the chosen one\n      for (const variant in test.variants) {\n        sum += test.variants[variant];\n        if (rand <= sum) {\n          chosenVariant = variant;\n          break;\n        }\n      }\n\n      // Set a cookie for the chosen variant\n      globalThis.document.cookie = `${cookieName}=${chosenVariant}; path=/; max-age=2592000`; // Expires in 30 days\n    }\n\n    // Insert CSS rules for the test\n    for (const variant in test.variants) {\n      const rule = `[ab-test-name=\"${test.name}\"][ab-test-variant=\"${variant}\"] { display: ${variant === chosenVariant ? \"inherit\" : \"none\"}; }`;\n      insertCssRule(rule);\n    }\n  }\n}\n\nconst configPath = globalThis.document?.currentScript?.getAttribute(\"config\");\nif (configPath) {\n  ensureStyleAppended();\n\n  fetch(configPath)\n    .then((response) => response.json())\n    .then(init)\n    .catch((error) => console.error(\"Error loading A/B test configuration:\", error));\n}\n"],
  "mappings": ";AAAe,SAAR,eAAgC,MAAkC;AACvE,MAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;AACrC,UAAM,IAAI,MAAM,8BAA8B;AAAA,EAChD;AAEA,QAAM,cAAc;AACpB,MAAI,CAAC,YAAY,KAAK,IAAI,GAAG;AAC3B,UAAM,IAAI,MAAM,mCAAmC;AAAA,EACrD;AAEA,QAAM,QAAQ,KAAK,SAAS;AAC5B,QAAM,QAAQ,MAAM,MAAM,KAAK,OAAO;AAEtC,MAAI,MAAM,WAAW,GAAG;AACtB,UAAM,eAAe,mBAAmB,MAAM,IAAI,GAAG,MAAM,GAAG,EAAE,MAAM,KAAK,EAAE;AAC7E,QAAI,cAAc;AAChB,aAAO;AAAA,IACT,OAAO;AACL,YAAM,IAAI,MAAM,6BAA6B;AAAA,IAC/C;AAAA,EACF;AACF;;;ACdA,SAAS,sBAAsB;AAC7B,MAAI,SAAS,eAAe,cAAc,GAAG;AAC3C;AAAA,EACF;AAEA,QAAM,QAAQ,WAAW,SAAS,cAAc,OAAO;AACvD,QAAM,KAAK;AACX,aAAW,SAAS,KAAK,YAAY,KAAK;AAE1C,gBAAc,uEAAuE;AACvF;AAEA,SAAS,cAAc,MAAc;AACnC,QAAM,aAAa,SAAS,eAAe,cAAc;AACzD,QAAM,QAAQ,WAAW;AACzB,QAAM,WAAW,MAAM,MAAM,SAAS,MAAM;AAC9C;AAEe,SAAR,KAAsB,QAA4B;AACvD,sBAAoB;AAEpB,aAAW,QAAQ,QAAQ;AACzB,cAAU,IAAI;AAAA,EAChB;AAEA,WAAS,UAAU,MAAwB;AACzC,UAAM,aAAa,MAAM,KAAK;AAC9B,QAAI,gBAAgB,eAAe,UAAU;AAE7C,QAAI,CAAC,eAAe;AAElB,YAAM,OAAO,KAAK,OAAO;AACzB,UAAI,MAAM;AAGV,iBAAW,WAAW,KAAK,UAAU;AACnC,eAAO,KAAK,SAAS,OAAO;AAC5B,YAAI,QAAQ,KAAK;AACf,0BAAgB;AAChB;AAAA,QACF;AAAA,MACF;AAGA,iBAAW,SAAS,SAAS,GAAG,cAAc;AAAA,IAChD;AAGA,eAAW,WAAW,KAAK,UAAU;AACnC,YAAM,OAAO,kBAAkB,KAAK,2BAA2B,wBAAwB,YAAY,gBAAgB,YAAY;AAC/H,oBAAc,IAAI;AAAA,IACpB;AAAA,EACF;AACF;AAEA,IAAM,aAAa,WAAW,UAAU,eAAe,aAAa,QAAQ;AAC5E,IAAI,YAAY;AACd,sBAAoB;AAEpB,QAAM,UAAU,EACb,KAAK,CAAC,aAAa,SAAS,KAAK,CAAC,EAClC,KAAK,IAAI,EACT,MAAM,CAAC,UAAU,QAAQ,MAAM,yCAAyC,KAAK,CAAC;AACnF;",
  "names": []
}
